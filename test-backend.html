<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste do Backend ANUBIS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            background: #2a2a2a;
            padding: 30px;
            border-radius: 10px;
            border: 2px solid #444;
        }
        button {
            background: #f59e0b;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #d97706;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: #064e3b;
            border: 2px solid #10b981;
            color: #10b981;
        }
        .error {
            background: #7f1d1d;
            border: 2px solid #ef4444;
            color: #ef4444;
        }
        .loading {
            background: #1e3a5f;
            border: 2px solid #3b82f6;
            color: #3b82f6;
        }
        .info {
            background: #1e3a5f;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Teste do Backend ANUBIS</h1>
        
        <div class="info">
            <strong>URL do Backend:</strong> <code>https://anubis-vdnn.onrender.com/api</code><br>
            <strong>Nota:</strong> No plano gratuito do Render, o backend pode demorar at√© 60 segundos para acordar na primeira requisi√ß√£o.
        </div>
        
        <button onclick="testConnection()">üîç Testar Conex√£o</button>
        <button onclick="testHealth()">üè• Testar Health Check</button>
        
        <div id="result"></div>
    </div>

    <script>
        const backendUrl = 'https://anubis-vdnn.onrender.com/api';
        const resultDiv = document.getElementById('result');

        function showResult(message, type = 'loading') {
            resultDiv.textContent = message;
            resultDiv.className = type;
        }

        async function testConnection() {
            showResult('‚è≥ Testando conex√£o... Aguarde (pode demorar at√© 60s na primeira vez)...', 'loading');
            
            try {
                const startTime = Date.now();
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 90000); // 90 segundos
                
                const response = await fetch(`${backendUrl}/health`, {
                    method: 'GET',
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                clearTimeout(timeoutId);
                const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
                
                if (response.ok) {
                    const data = await response.json();
                    showResult(
                        `‚úÖ SUCESSO! Backend est√° ONLINE!\n\n` +
                        `‚è±Ô∏è Tempo de resposta: ${elapsed} segundos\n\n` +
                        `üìä Status: ${data.status}\n` +
                        `üïê Timestamp: ${data.timestamp}\n` +
                        `üíæ Banco de Dados: ${data.database?.status || 'N/A'}\n` +
                        `üìà Uptime: ${data.uptime ? data.uptime.toFixed(2) + 's' : 'N/A'}\n\n` +
                        `üéâ O app mobile deve funcionar agora!`,
                        'success'
                    );
                } else {
                    showResult(
                        `‚ö†Ô∏è Backend respondeu, mas com erro\n\n` +
                        `Status: ${response.status}\n` +
                        `Mensagem: ${response.statusText}`,
                        'error'
                    );
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    showResult(
                        `‚ùå TIMEOUT!\n\n` +
                        `O backend n√£o respondeu em 90 segundos.\n\n` +
                        `Poss√≠veis causas:\n` +
                        `‚Ä¢ Backend est√° hibernando (plano gratuito)\n` +
                        `‚Ä¢ Backend n√£o est√° configurado corretamente\n` +
                        `‚Ä¢ Problema no deploy\n\n` +
                        `üí° Solu√ß√µes:\n` +
                        `1. Acesse o dashboard do Render.com\n` +
                        `2. Verifique se o servi√ßo est√° "Live"\n` +
                        `3. Verifique os logs do backend\n` +
                        `4. Tente fazer um novo deploy`,
                        'error'
                    );
                } else {
                    showResult(
                        `‚ùå ERRO de conex√£o!\n\n` +
                        `Erro: ${error.message}\n\n` +
                        `üí° Verifique:\n` +
                        `‚Ä¢ Sua conex√£o com a internet\n` +
                        `‚Ä¢ Se o backend est√° online no Render\n` +
                        `‚Ä¢ Se a URL est√° correta`,
                        'error'
                    );
                }
            }
        }

        async function testHealth() {
            await testConnection();
        }
    </script>
</body>
</html>

